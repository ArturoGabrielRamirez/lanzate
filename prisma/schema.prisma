generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["fullTextSearchPostgres"]
  binaryTargets   = ["native", "rhel-openssl-3.0.x"]
}

datasource db {
  provider  = "postgresql"
  url       = env("PRISMA_DATABASE_URL")
  directUrl = env("PRISMA_DIRECT_URL")
}

model User {
  id                        Int                     @id @default(autoincrement())
  email                     String                  @unique
  avatar                    String?
  created_at                DateTime                @default(now())
  first_name                String?
  last_name                 String?
  password                  String
  updated_at                DateTime                @updatedAt
  Account                   Account[]
  ActionLog                 ActionLog[]
  contracts_assigned        ContractAssignment[]    @relation("ContractAssignedBy")
  contracts_created         Contract[]              @relation("ContractCreatedBy")
  email_change_requests     email_change_requests[]
  Employee                  Employee[]
  Notification              Notification[]
  order_messages            OrderMessage[]          @relation("OrderMessageSender")
  orders_as_customer        Order[]                 @relation("OrderCustomer")
  orders_processed          Order[]                 @relation("OrderProcessedBy")
  product_comments          product_comments[]
  product_likes             product_likes[]
  Product                   Product[]
  store_reminders_completed StoreReminder[]         @relation("StoreReminderCompletedBy")
  store_reminders_created   StoreReminder[]         @relation("StoreReminderCreatedBy")
  Store                     Store[]
  user_reminders            UserReminder[]

  @@map("users")
}

model Notification {
  id         Int      @id @default(autoincrement())
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt
  user_id    Int
  type       String
  read       Boolean  @default(false)
  title      String
  message    String
  link       String?
  user       User     @relation(fields: [user_id], references: [id])

  @@map("notifications")
}

model Store {
  id                   Int                       @id @default(autoincrement())
  name                 String
  description          String?
  logo                 String?
  slogan               String?
  created_at           DateTime                  @default(now())
  updated_at           DateTime                  @updatedAt
  user_id              Int
  slug                 String                    @unique
  subdomain            String                    @unique
  branches             Branch[]
  categories           Category[]
  contracts            Contract[]
  employees            Employee[]
  orders               Order[]
  products             Product[]
  balance              StoreBalance?
  customization        StoreCustomization?
  operational_settings StoreOperationalSettings?
  store_reminders      StoreReminder[]
  user                 User                      @relation(fields: [user_id], references: [id])
  transactions         Transaction[]

  @@map("stores")
}

model Account {
  id         Int         @id @default(autoincrement())
  created_at DateTime    @default(now())
  updated_at DateTime    @updatedAt
  user_id    Int
  type       AccountType @default(FREE)
  user       User        @relation(fields: [user_id], references: [id])

  @@map("accounts")
}

model Product {
  id               Int                @id @default(autoincrement())
  name             String
  description      String?
  price            Float
  stock            Int
  created_at       DateTime           @default(now())
  updated_at       DateTime           @updatedAt
  store_id         Int
  tags             String[]
  barcode          String?
  image            String?
  owner_id         Int
  sku              String             @unique
  slug             String             @unique
  video            String?
  is_active        Boolean            @default(true)
  is_featured      Boolean            @default(false)
  is_published     Boolean            @default(false)
  order_items      OrderItem[]
  product_comments product_comments[]
  product_likes    product_likes[]
  stock_entries    ProductStock[]
  owner            User               @relation(fields: [owner_id], references: [id])
  store            Store              @relation(fields: [store_id], references: [id])
  categories       Category[]         @relation("CategoryToProduct")

  @@map("products")
}

model Branch {
  id          Int            @id @default(autoincrement())
  name        String
  description String?
  address     String?
  phone       String?
  email       String?
  created_at  DateTime       @default(now())
  updated_at  DateTime       @updatedAt
  store_id    Int
  is_main     Boolean        @default(false)
  store       Store          @relation(fields: [store_id], references: [id], onDelete: Cascade)
  orders      Order[]
  stock       ProductStock[]

  @@map("branches")
}

model ProductStock {
  quantity   Int
  product_id Int
  branch_id  Int
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  branch     Branch   @relation(fields: [branch_id], references: [id], onDelete: Cascade)
  product    Product  @relation(fields: [product_id], references: [id], onDelete: Cascade)

  @@id([product_id, branch_id])
  @@map("product_stocks")
}

model Category {
  id          Int       @id @default(autoincrement())
  name        String
  description String?
  image       String?
  slug        String
  created_at  DateTime  @default(now())
  is_active   Boolean   @default(true)
  is_default  Boolean   @default(false)
  sort_order  Int       @default(0)
  store_id    Int
  updated_at  DateTime  @updatedAt
  store       Store     @relation(fields: [store_id], references: [id], onDelete: Cascade)
  products    Product[] @relation("CategoryToProduct")

  @@unique([store_id, slug])
  @@map("categories")
}

model DefaultCategory {
  id          Int      @id @default(autoincrement())
  name        String
  description String?
  image       String?
  slug        String   @unique
  sort_order  Int      @default(0)
  is_active   Boolean  @default(true)
  created_at  DateTime @default(now())
  updated_at  DateTime @updatedAt

  @@map("default_categories")
}

model Order {
  id                   Int                  @id @default(autoincrement())
  created_at           DateTime             @default(now())
  updated_at           DateTime             @updatedAt
  store_id             Int
  branch_id            Int
  total_price          Float
  total_quantity       Int
  status               OrderStatus          @default(PENDING)
  is_paid              Boolean              @default(false)
  payment_date         DateTime?
  customer_email       String?
  customer_id          Int?
  customer_name        String?
  customer_phone       String?
  processed_by_user_id Int?
  address_one          String?
  address_two          String?
  city                 String?
  country              String?
  state                String?
  zip_code             String?
  order_type           OrderType            @default(CASH_REGISTER)
  payment_method       PaymentMethod?       @default(CASH)
  shipping_method      ShippingMethod       @default(PICKUP)
  items                OrderItem[]
  messages             OrderMessage[]
  payment              OrderPayment?
  branch               Branch               @relation(fields: [branch_id], references: [id])
  customer             User?                @relation("OrderCustomer", fields: [customer_id], references: [id])
  processed_by         User?                @relation("OrderProcessedBy", fields: [processed_by_user_id], references: [id])
  store                Store                @relation(fields: [store_id], references: [id])
  tracking             OrderTracking?

  @@map("orders")
}

model OrderItem {
  id         Int     @id @default(autoincrement())
  order_id   Int
  product_id Int
  quantity   Int
  price      Float
  order      Order   @relation(fields: [order_id], references: [id])
  product    Product @relation(fields: [product_id], references: [id])

  @@map("order_items")
}

model OrderPayment {
  id       Int                @id @default(autoincrement())
  order_id Int                @unique
  amount   Float
  status   OrderPaymentStatus @default(PENDING)
  order    Order              @relation(fields: [order_id], references: [id])

  @@map("order_payments")
}

model StoreBalance {
  id              Int      @id @default(autoincrement())
  store_id        Int      @unique
  current_balance Float    @default(0)
  created_at      DateTime @default(now())
  updated_at      DateTime @updatedAt
  store           Store    @relation(fields: [store_id], references: [id], onDelete: Cascade)

  @@map("store_balances")
}

model Transaction {
  id                     Int             @id @default(autoincrement())
  store_id               Int
  type                   TransactionType
  amount                 Float
  balance_before         Float
  balance_after          Float
  description            String
  reference_type         String?
  reference_id           Int?
  created_at             DateTime        @default(now())
  updated_at             DateTime        @updatedAt
  notes                  String?
  created_by             Int?
  branch_id              Int?
  created_by_employee_id Int?
  created_by_employee    Employee?       @relation(fields: [created_by_employee_id], references: [id])
  store                  Store           @relation(fields: [store_id], references: [id], onDelete: Cascade)

  @@map("transactions")
}

model ActionLog {
  id               Int        @id @default(autoincrement())
  created_at       DateTime   @default(now())
  updated_at       DateTime   @updatedAt
  user_id          Int?
  action           ActionType
  entity_type      EntityType
  entity_id        Int
  details          String?
  action_initiator String?
  employee_id      Int?
  employee         Employee?  @relation(fields: [employee_id], references: [id])
  user             User?      @relation(fields: [user_id], references: [id])

  @@map("action_logs")
}

model Employee {
  id                   Int                  @id @default(autoincrement())
  user_id              Int
  store_id             Int
  role                 EmployeeRole         @default(EMPLOYEE)
  can_create_orders    Boolean              @default(false)
  can_update_orders    Boolean              @default(false)
  can_create_products  Boolean              @default(false)
  can_update_products  Boolean              @default(false)
  can_manage_stock     Boolean              @default(false)
  can_process_refunds  Boolean              @default(false)
  can_view_reports     Boolean              @default(false)
  can_manage_employees Boolean              @default(false)
  can_manage_store     Boolean              @default(false)
  is_active            Boolean              @default(true)
  hired_at             DateTime             @default(now())
  fired_at             DateTime?
  position             String?
  department           String?
  salary               Float?
  notes                String?
  created_at           DateTime             @default(now())
  updated_at           DateTime             @updatedAt
  action_logs          ActionLog[]
  contract_assignments ContractAssignment[]
  contract_responses   ContractResponse[]
  store                Store                @relation(fields: [store_id], references: [id], onDelete: Cascade)
  user                 User                 @relation(fields: [user_id], references: [id])
  assigned_reminders   StoreReminder[]
  transactions         Transaction[]

  @@unique([user_id, store_id])
  @@map("employees")
}

model StoreOperationalSettings {
  id                          Int             @id @default(autoincrement())
  store_id                    Int             @unique
  offers_delivery             Boolean         @default(false)
  delivery_price              Float?          @default(0)
  free_delivery_minimum       Float?
  delivery_radius_km          Float?          @default(5)
  monday_open                 String?
  monday_close                String?
  tuesday_open                String?
  tuesday_close               String?
  wednesday_open              String?
  wednesday_close             String?
  thursday_open               String?
  thursday_close              String?
  friday_open                 String?
  friday_close                String?
  saturday_open               String?
  saturday_close              String?
  sunday_open                 String?
  sunday_close                String?
  delivery_time_min           Int?            @default(30)
  delivery_time_max           Int?            @default(60)
  pickup_time_min             Int?            @default(15)
  pickup_time_max             Int?            @default(30)
  payment_methods             PaymentMethod[] @default([CASH])
  requires_phone_for_delivery Boolean         @default(true)
  minimum_order_amount        Float?          @default(0)
  preparation_time_buffer     Int?            @default(10)
  is_temporarily_closed       Boolean         @default(false)
  temporary_closure_reason    String?
  contact_phone               String?
  contact_whatsapp            String?
  contact_email               String?
  delivery_instructions       String?
  pickup_instructions         String?
  special_notes               String?
  created_at                  DateTime        @default(now())
  updated_at                  DateTime        @updatedAt
  contact_phone_2             String?
  contact_whatsapp_2          String?
  facebook_url                String?
  instagram_url               String?
  x_url                       String?
  store                       Store           @relation(fields: [store_id], references: [id], onDelete: Cascade)

  @@map("store_operational_settings")
}

model StoreCustomization {
  id                     Int                  @id @default(autoincrement())
  store_id               Int                  @unique
  primary_color          String               @default("#000000")
  secondary_color        String               @default("#ffffff")
  accent_color           String               @default("#6366f1")
  background_color       String               @default("#ffffff")
  text_color             String               @default("#000000")
  secondary_text_color   String               @default("#6b7280")
  border_color           String               @default("#e5e7eb")
  success_color          String               @default("#10b981")
  warning_color          String               @default("#f59e0b")
  error_color            String               @default("#ef4444")
  primary_font           String               @default("Inter")
  secondary_font         String               @default("Inter")
  font_size_base         String               @default("16px")
  show_header            Boolean              @default(true)
  show_logo              Boolean              @default(true)
  show_search_bar        Boolean              @default(true)
  show_navigation_menu   Boolean              @default(true)
  show_cart_icon         Boolean              @default(true)
  show_user_account      Boolean              @default(true)
  header_position        HeaderPosition       @default(TOP)
  header_style           HeaderStyle          @default(MODERN)
  show_footer            Boolean              @default(true)
  footer_text            String?
  show_social_links      Boolean              @default(true)
  show_contact_info      Boolean              @default(true)
  show_store_info        Boolean              @default(true)
  layout_style           LayoutStyle          @default(MODERN)
  container_max_width    String               @default("1200px")
  border_radius          String               @default("8px")
  spacing_unit           String               @default("1rem")
  show_hero_section      Boolean              @default(true)
  show_featured_products Boolean              @default(true)
  show_categories        Boolean              @default(true)
  show_testimonials      Boolean              @default(false)
  show_about_section     Boolean              @default(false)
  products_per_page      Int                  @default(12)
  product_card_style     ProductCardStyle     @default(MODERN)
  show_product_rating    Boolean              @default(true)
  show_product_stock     Boolean              @default(true)
  show_add_to_cart_btn   Boolean              @default(true)
  custom_css             String?
  custom_js              String?
  favicon_url            String?
  meta_title             String?
  meta_description       String?
  google_analytics_id    String?
  facebook_pixel_id      String?
  google_tag_manager_id  String?
  created_at             DateTime             @default(now())
  updated_at             DateTime             @updatedAt
  store                  Store                @relation(fields: [store_id], references: [id], onDelete: Cascade)
  sections               StoreSectionConfig[]
  widgets                StoreWidgetConfig[]

  @@map("store_customizations")
}

model StoreSectionConfig {
  id               Int                @id @default(autoincrement())
  customization_id Int
  section_type     SectionType
  section_name     String
  is_visible       Boolean            @default(true)
  sort_order       Int                @default(0)
  background_color String?
  text_color       String?
  padding          String?            @default("2rem")
  margin           String?            @default("0")
  title            String?
  subtitle         String?
  description      String?
  image_url        String?
  button_text      String?
  button_link      String?
  show_title       Boolean            @default(true)
  show_subtitle    Boolean            @default(true)
  show_description Boolean            @default(true)
  columns_count    Int?               @default(3)
  items_per_row    Int?               @default(4)
  layout_style     String?            @default("grid")
  config_json      String?
  created_at       DateTime           @default(now())
  updated_at       DateTime           @updatedAt
  customization    StoreCustomization @relation(fields: [customization_id], references: [id], onDelete: Cascade)

  @@unique([customization_id, section_type])
  @@map("store_section_configs")
}

model StoreWidgetConfig {
  id               Int                @id @default(autoincrement())
  customization_id Int
  widget_type      WidgetType
  widget_name      String
  position         WidgetPosition     @default(SIDEBAR)
  sort_order       Int                @default(0)
  is_visible       Boolean            @default(true)
  background_color String?
  text_color       String?
  border_color     String?
  padding          String?            @default("1rem")
  margin           String?            @default("0.5rem")
  border_radius    String?            @default("8px")
  title            String?
  show_title       Boolean            @default(true)
  max_items        Int?               @default(5)
  auto_refresh     Boolean            @default(false)
  refresh_interval Int?               @default(300)
  config_json      String?
  created_at       DateTime           @default(now())
  updated_at       DateTime           @updatedAt
  customization    StoreCustomization @relation(fields: [customization_id], references: [id], onDelete: Cascade)

  @@map("store_widget_configs")
}

model Contract {
  id              Int                  @id @default(autoincrement())
  store_id        Int
  title           String
  file_url        String
  comments        String?
  status          ContractStatus       @default(PENDING)
  created_at      DateTime             @default(now())
  updated_at      DateTime             @updatedAt
  created_by      Int
  assignments     ContractAssignment[]
  responses       ContractResponse[]
  created_by_user User                 @relation("ContractCreatedBy", fields: [created_by], references: [id])
  store           Store                @relation(fields: [store_id], references: [id], onDelete: Cascade)

  @@map("contracts")
}

model ContractAssignment {
  id               Int                @id @default(autoincrement())
  contract_id      Int
  employee_id      Int
  assigned_at      DateTime           @default(now())
  status           ContractStatus     @default(PENDING)
  assigned_by      Int
  assigned_by_user User               @relation("ContractAssignedBy", fields: [assigned_by], references: [id])
  contract         Contract           @relation(fields: [contract_id], references: [id], onDelete: Cascade)
  employee         Employee           @relation(fields: [employee_id], references: [id], onDelete: Cascade)
  responses        ContractResponse[]

  @@unique([contract_id, employee_id])
  @@map("contract_assignments")
}

model ContractResponse {
  id            Int                 @id @default(autoincrement())
  contract_id   Int
  employee_id   Int
  status        ContractStatus
  comments      String?
  created_at    DateTime            @default(now())
  updated_at    DateTime            @updatedAt
  assignment_id Int?
  assignment    ContractAssignment? @relation(fields: [assignment_id], references: [id], onDelete: Cascade)
  contract      Contract            @relation(fields: [contract_id], references: [id], onDelete: Cascade)
  employee      Employee            @relation(fields: [employee_id], references: [id], onDelete: Cascade)

  @@map("contract_responses")
}

model product_comments {
  id         Int      @id @default(autoincrement())
  user_id    Int
  product_id Int
  content    String
  is_active  Boolean  @default(true)
  created_at DateTime @default(now())
  updated_at DateTime
  products   Product  @relation(fields: [product_id], references: [id], onDelete: Cascade)
  users      User     @relation(fields: [user_id], references: [id], onDelete: Cascade)
}

model product_likes {
  user_id    Int
  product_id Int
  created_at DateTime @default(now())
  products   Product  @relation(fields: [product_id], references: [id], onDelete: Cascade)
  users      User     @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@id([user_id, product_id])
}

model OrderMessage {
  id           Int         @id @default(autoincrement())
  order_id     Int
  sender_id    Int
  message      String
  message_type MessageType @default(CUSTOMER_TO_STORE)
  file_url     String?
  file_name    String?
  file_size    Int?
  is_read      Boolean     @default(false)
  read_at      DateTime?
  created_at   DateTime    @default(now())
  updated_at   DateTime    @updatedAt
  order        Order       @relation(fields: [order_id], references: [id], onDelete: Cascade)
  sender       User        @relation("OrderMessageSender", fields: [sender_id], references: [id])

  @@map("order_messages")
}

model UserReminder {
  id                  Int              @id @default(autoincrement())
  user_id             Int
  title               String
  description         String?
  due_date            DateTime
  priority            ReminderPriority @default(MEDIUM)
  status              ReminderStatus   @default(PENDING)
  category            String?
  color               String?
  is_recurring        Boolean          @default(false)
  recurrence_pattern  String?
  recurrence_end_date DateTime?
  completed_at        DateTime?
  created_at          DateTime         @default(now())
  updated_at          DateTime         @updatedAt
  user                User             @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@map("user_reminders")
}

model StoreReminder {
  id                  Int              @id @default(autoincrement())
  store_id            Int
  title               String
  description         String?
  due_date            DateTime
  priority            ReminderPriority @default(MEDIUM)
  status              ReminderStatus   @default(PENDING)
  category            String?
  color               String?
  is_recurring        Boolean          @default(false)
  recurrence_pattern  String?
  recurrence_end_date DateTime?
  assigned_to         Int?
  created_by          Int
  completed_at        DateTime?
  completed_by        Int?
  created_at          DateTime         @default(now())
  updated_at          DateTime         @updatedAt
  assigned_employee   Employee?        @relation(fields: [assigned_to], references: [id])
  completed_by_user   User?            @relation("StoreReminderCompletedBy", fields: [completed_by], references: [id])
  created_by_user     User             @relation("StoreReminderCreatedBy", fields: [created_by], references: [id])
  store               Store            @relation(fields: [store_id], references: [id], onDelete: Cascade)

  @@map("store_reminders")
}

model email_change_requests {
  id                     String    @id
  user_id                Int
  old_email              String
  new_email              String
  old_email_confirmed    Boolean   @default(false)
  new_email_confirmed    Boolean   @default(false)
  old_email_confirmed_at DateTime?
  new_email_confirmed_at DateTime?
  completed              Boolean   @default(false)
  completed_at           DateTime?
  expires_at             DateTime
  created_at             DateTime  @default(now())
  updated_at             DateTime
  users                  User      @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([completed])
  @@index([expires_at])
  @@index([user_id])
}

model OrderTracking {
  id Int @id @default(autoincrement())

  order_id Int @unique

  tracking_status OrderTrackingStatus @default(PREPARING_ORDER)

  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  order Order @relation(fields: [order_id], references: [id], onDelete: Cascade)

  @@map("order_tracking")
}

enum OrderTrackingStatus {
  PREPARING_ORDER
  WAITING_FOR_PICKUP
  PICKED_UP
  WAITING_FOR_DELIVERY
  ON_THE_WAY
  DELIVERED
  CANCELLED
}

enum MessageType {
  CUSTOMER_TO_STORE
  STORE_TO_CUSTOMER
  SYSTEM
}

enum AccountType {
  FREE
  PRO
  ENTERPRISE
}

enum OrderStatus {
  PENDING
  PROCESSING
  READY
  SHIPPED
  DELIVERED
  CANCELLED
  COMPLETED
}

enum OrderPaymentStatus {
  PENDING
  PAID
  CANCELLED
}

enum TransactionType {
  SALE
  REFUND
  MANUAL_INCOME
  MANUAL_EXPENSE
  SERVICE_INCOME
  SERVICE_REFUND
  ADJUSTMENT
  WITHDRAWAL
  DEPOSIT
}

enum ActionType {
  CREATE
  UPDATE
  DELETE
  LOGIN
  LOGOUT
}

enum EntityType {
  USER
  STORE
  PRODUCT
  ORDER
  BRANCH
  CATEGORY
  TAG
  STOCK
  TRANSACTION
  EMPLOYEE
  SETTINGS
}

enum EmployeeRole {
  OWNER
  MANAGER
  SUPERVISOR
  EMPLOYEE
  CASHIER
  STOCKIST
  SALES
}

enum PaymentMethod {
  CASH
  CREDIT_CARD
  DEBIT_CARD
  TRANSFER
  MERCADO_PAGO
  PAYPAL
  CRYPTO
}

enum HeaderPosition {
  TOP
  FIXED_TOP
  STICKY
}

enum HeaderStyle {
  MODERN
  CLASSIC
  MINIMAL
  BOLD
}

enum LayoutStyle {
  MODERN
  CLASSIC
  MINIMAL
  GRID
  MAGAZINE
}

enum ProductCardStyle {
  MODERN
  CLASSIC
  MINIMAL
  DETAILED
  COMPACT
}

enum SectionType {
  HERO
  FEATURED_PRODUCTS
  CATEGORIES
  ABOUT
  TESTIMONIALS
  NEWSLETTER
  CONTACT
  CUSTOM_HTML
  PRODUCT_GRID
  BANNER
  VIDEO
  GALLERY
  FAQ
  BLOG_POSTS
  SOCIAL_FEED
}

enum WidgetType {
  FEATURED_PRODUCTS
  RECENT_PRODUCTS
  POPULAR_PRODUCTS
  CATEGORIES
  SEARCH
  CART_SUMMARY
  USER_MENU
  SOCIAL_LINKS
  CONTACT_INFO
  NEWSLETTER_SIGNUP
  RECENT_ORDERS
  TESTIMONIALS
  CUSTOM_HTML
  WEATHER
  CLOCK
  ANNOUNCEMENTS
}

enum WidgetPosition {
  HEADER
  SIDEBAR
  FOOTER
  FLOATING
  MODAL
  BANNER_TOP
  BANNER_BOTTOM
}

enum ContractStatus {
  PENDING
  APPROVED
  REJECTED
  COMPLETED
  EXPIRED
}

enum OrderType {
  CASH_REGISTER
  PUBLIC_STORE
}

enum ShippingMethod {
  PICKUP
  DELIVERY
}

enum ReminderPriority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

enum ReminderStatus {
  PENDING
  COMPLETED
  OVERDUE
}

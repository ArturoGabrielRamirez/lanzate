# Spec Requirements: User Authentication

## Initial Description
User Authentication - Implement user registration, login, logout, and password recovery using Supabase Auth. Include email verification, protected routes, and session management.

This is item 1 from the roadmap and should support:
- User registration with email verification
- Login/logout functionality
- Password recovery
- Protected routes and session management
- Integration with Supabase Auth

## Requirements Discussion

### First Round Questions

**Q1:** I assume you want to migrate the authentication implementation from the backup folder (backup/features/auth) and adapt it to the new architecture. Is that correct, or should we build from scratch?
**Answer:** Yes, keep in mind the old implementation from backup/features/auth and backup/app/login, backup/app/signup pages but make sure the new implementation follows the new architecture standards defined by the rules of the project.

**Q2:** For authentication methods, should we support email/password, Google OAuth, and Facebook OAuth as mentioned in the tech stack, or just a subset of these?
**Answer:** Email/password and Google auth only (no Facebook).

**Q3:** Should email verification be required before users can access the application, or can they access their account immediately after registration?
**Answer:** Don't implement email verification at all.

**Q4:** For the registration form, what user information should we collect beyond email and password? (e.g., username, full name, phone number)
**Answer:** Only email and password. Username should be autogenerated from the email first part (before @).

**Q5:** Should authenticated users who try to access /login or /signup be automatically redirected to /dashboard?
**Answer:** Yes, authenticated users trying to access /login or /signup should be redirected to /dashboard.

**Q6:** For password reset flow, should we show a confirmation page after the user requests a reset (e.g., "Check your email"), or just display an inline message?
**Answer:** Yes, show a "check your email" confirmation page after requesting password reset.

**Q7:** Should we implement session timeout/auto-logout after inactivity, or rely on Supabase's default session management?
**Answer:** Use Supabase's default settings, no custom timeout.

**Q8:** After successful Supabase signup, should we automatically create a corresponding user record in our database via a server action?
**Answer:** Yes, via server action flow after successful Supabase signup.

**Q9:** For OAuth flows (Google), where should users be redirected after successful authentication? Do we need an onboarding step or direct to dashboard?
**Answer:** Redirect to /dashboard (no onboarding step).

**Q10:** How should we display validation errors? Inline below each field, in a toast notification, or in an alert banner at the top of the form?
**Answer:** Inline validation errors. Use https://ui.shadcn.com/docs/components/field and https://ui.shadcn.com/docs/components/input-group components from shadcn. Create a global input-field component that can be reused across the app (check previous implementation in backup folder).

**Q11:** Should we support internationalization (i18n) for auth flows using next-intl, or start with English only?
**Answer:** Yes, support both Spanish and English using next-intl.

**Q12:** Are there any specific features you want to exclude from this initial implementation? For example: email change, account deletion, two-factor authentication, "remember me" functionality, social login beyond Google, account suspension/deactivation?
**Answer:** Exclude email change, user deletion, 2FA, remember me, and account suspension. Include profile editing only.

### Existing Code to Reference

**Similar Features Identified:**
- Feature: Form and InputField components - Path: `backup folder`
- Components to potentially reuse: Form component structure and InputField implementation patterns
- Backend logic to reference: Authentication logic from `backup/features/auth`, login/signup page implementations from `backup/app/login` and `backup/app/signup`

**Note:** No similar features exist in the current codebase. All references are from the backup folder which contains the old implementation that needs to be migrated to the new architecture.

## Visual Assets

### Files Provided:
No visual assets provided.

### Visual Insights:
Not applicable - no visual files found.

## Requirements Summary

### Functional Requirements

**Authentication Methods:**
- Email/password authentication
- Google OAuth authentication only (no Facebook)
- No email verification required

**Registration Flow:**
- Collect only email and password
- Auto-generate username from email prefix (before @)
- Create Supabase auth user
- Create corresponding database user record via server action
- Redirect to /dashboard after successful registration

**Login Flow:**
- Support email/password login
- Support Google OAuth login
- Redirect authenticated users away from /login and /signup to /dashboard
- Redirect to /dashboard after successful authentication (no onboarding)
- Use Supabase default session management (no custom timeout)

**Password Recovery Flow:**
- Password reset request form
- Display "check your email" confirmation page after request
- Password reset form (from email link)
- Update password via Supabase

**Logout:**
- Clear Supabase session
- Redirect to landing or login page

**Protected Routes:**
- Implement route protection for authenticated-only pages
- Redirect unauthenticated users to /login

**Profile Management:**
- Basic profile editing capability (included)
- No email change, account deletion, or suspension features

**Error Handling:**
- Inline validation errors below each field
- Use shadcn Field and Input Group components
- Create reusable global input-field component

**Internationalization:**
- Support Spanish and English using next-intl
- All auth forms and messages must be translatable

### Reusability Opportunities

**Components from backup folder to reference:**
- Form component structure and patterns
- InputField implementation
- Authentication flow logic from `backup/features/auth`
- Login page implementation from `backup/app/login`
- Signup page implementation from `backup/app/signup`

**New global components to create:**
- Reusable input-field component (based on shadcn Field and Input Group)
- This component should be usable across the entire application

### Scope Boundaries

**In Scope:**
- User registration (email/password only, no verification)
- Login (email/password and Google OAuth)
- Logout functionality
- Password recovery flow with confirmation page
- Protected routes and session management
- Auto-redirect authenticated users from /login and /signup
- Database user creation via server actions
- Basic profile editing
- Internationalization (Spanish and English)
- Global reusable input-field component
- Migration from backup folder to new architecture

**Out of Scope:**
- Email verification
- Facebook OAuth
- Email change functionality
- Account deletion
- Two-factor authentication (2FA)
- "Remember me" functionality
- Custom session timeout (use Supabase defaults)
- Account suspension/deactivation
- Onboarding flow after OAuth
- Advanced profile features beyond basic editing

### Technical Considerations

**Integration Points:**
- Supabase Auth for authentication
- Supabase database for user records
- Server actions for database user creation
- next-intl for internationalization
- shadcn UI components (Field, Input Group)

**Architecture Constraints:**
- Must follow new project architecture standards
- Reference backup folder implementation but adapt to new standards
- Use server actions for server-side operations
- Follow validation patterns defined in project standards

**Component Requirements:**
- Create global input-field component based on shadcn
- Reusable across entire application
- Support inline validation error display
- Reference backup folder implementation patterns

**Migration Considerations:**
- Old implementation exists in backup/features/auth
- Old login page in backup/app/login
- Old signup page in backup/app/signup
- Must adapt these to new architecture while preserving functionality
- Follow project's coding standards, conventions, and patterns
